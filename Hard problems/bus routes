class Solution {
    public int numBusesToDestination(int[][] routes, int source, int target) {
        if(source == target)
        return 0;
        Map<Integer, List<Integer>> busStop = new HashMap<>();
        for(int busId=0; busId<routes.length; busId++){
            for(int stop : routes[busId]){
                busStop.computeIfAbsent(stop, k -> new ArrayList<Integer>()).add(busId);
            }
        }
        HashSet<Integer> visitedBuses = new HashSet<>();
        HashSet<Integer> visitedStops = new HashSet<>();
        Queue<int[]> queue = new LinkedList<>();
        queue.offer(new int[]{source, 0});
        visitedStops.add(source);

        while(!queue.isEmpty()){
            int current[] = queue.poll();
            int currentStop = current[0];
            int busTaken = current[1];

            if(!busStop.containsKey(currentStop))
            continue;
            for(int busId : busStop.get(currentStop)){
                if(visitedBuses.contains(busId))
                continue;
                visitedBuses.add(busId);

                for(int nextStop : routes[busId]){
                    if(nextStop == target)
                    return busTaken + 1;

                    if(!visitedStops.contains(nextStop)){
                        visitedStops.add(nextStop);
                        queue.offer(new int[]{nextStop, busTaken+1});
                    }
                }
            }
        }
        return -1;
    }
}
